<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="INHUMAN SYSTEMS // WRITINGS">
    <title>WRITINGS // INHUMAN SYSTEMS</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="ai-artifacts"></div>
    <div class="ai-noise"></div>
    <div class="scanlines"></div>

    <div class="container">
        <header class="page-header">
            <h1 class="page-title">WRITINGS</h1>
            <p class="page-subtitle">cat /var/log/transmissions/*</p>
        </header>

        <nav>
            <a href="index.html">[INDEX]</a>
            <a href="projects.html">[PROJECTS]</a>
            <a href="writings.html" class="nav-active">[WRITINGS]</a>
            <a href="index.html#contact">[CONTACT]</a>
        </nav>

        <hr class="divider">

        <main id="writings-container">
            <div class="loading-state">
                <span class="mono">&gt; loading transmissions...</span>
            </div>
        </main>

        <hr class="divider">

        <footer>
            <a href="index.html" class="back-link">&lt;-- index</a>
        </footer>
    </div>

    <script>
        (function () {
            const container = document.getElementById('writings-container');

            fetch('writings/manifest.json')
                .then(res => res.json())
                .then(writings => {
                    if (writings.length === 0) {
                        container.innerHTML = '<p class="empty-state">NO TRANSMISSIONS FOUND</p>';
                        return;
                    }

                    writings.sort((a, b) => new Date(b.date) - new Date(a.date));

                    let html = '';
                    writings.forEach((writing, index) => {
                        const tags = writing.tags ? writing.tags.join(' / ') : '';

                        html += `
                            <article class="writing-block">
                                <div class="writing-meta-bar">
                                    <span class="writing-date">${writing.date}</span>
                                    <span class="writing-tags">${tags}</span>
                                </div>
                                <h2 class="writing-title">${writing.title}</h2>
                                <div class="writing-content" id="content-${index}">
                                    <span class="mono">&gt; loading...</span>
                                </div>
                                <div class="writing-actions">
                                    <a href="writings/${writing.file}" target="_blank">[RAW]</a>
                                </div>
                            </article>
                            ${index < writings.length - 1 ? '<hr class="divider">' : ''}
                        `;
                    });

                    container.innerHTML = html;

                    writings.forEach((writing, index) => {
                        fetch('writings/' + writing.file)
                            .then(res => res.text())
                            .then(content => {
                                const contentEl = document.getElementById('content-' + index);
                                // Convert newlines to HTML
                                const formatted = content
                                    .split('\n\n')
                                    .map(p => `<p>${p.replace(/\n/g, '<br>')}</p>`)
                                    .join('');
                                contentEl.innerHTML = formatted;
                            })
                            .catch(() => {
                                document.getElementById('content-' + index).innerHTML =
                                    '<p class="error-state">ERROR: FILE NOT FOUND</p>';
                            });
                    });
                })
                .catch(err => {
                    container.innerHTML = `<p class="error-state">ERROR: ${err.message}</p>`;
                });
        })();
    </script>

    <script>
        (function () {
            let t = 0;
            document.addEventListener('mousemove', function (e) {
                if (Date.now() - t < 50) return;
                t = Date.now();
                const p = document.createElement('div');
                p.className = 'cursor-trail';
                p.style.left = e.clientX + 'px';
                p.style.top = e.clientY + 'px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 800);
            });
        })();
    </script>
</body>

</html>