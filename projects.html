<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="INHUMAN SYSTEMS // PROJECTS">
    <title>PROJECTS // INHUMAN SYSTEMS</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="ai-artifacts"></div>
    <div class="ai-noise"></div>
    <div class="scanlines"></div>

    <div class="container">
        <header class="page-header">
            <h1 class="page-title">PROJECTS</h1>
            <p class="page-subtitle">sys.path.insert(0, "/projects")</p>
        </header>

        <nav>
            <a href="index.html">[INDEX]</a>
            <a href="projects.html" class="nav-active">[PROJECTS]</a>
            <a href="writings.html">[WRITINGS]</a>
            <a href="index.html#contact">[CONTACT]</a>
        </nav>

        <hr class="divider">

        <main id="projects-container">
            <div class="loading-state">
                <span class="mono">&gt; loading projects...</span>
            </div>
        </main>

        <hr class="divider">

        <footer>
            <a href="index.html" class="back-link">&lt;-- index</a>
        </footer>
    </div>

    <script>
        // Minimal Markdown parser - no dependencies
        function parseMarkdown(md) {
            let html = md
                // Code blocks (must be first)
                .replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code class="lang-$1">$2</code></pre>')
                // Inline code
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                // Headers
                .replace(/^### (.*$)/gm, '<h4>$1</h4>')
                .replace(/^## (.*$)/gm, '<h3>$1</h3>')
                .replace(/^# (.*$)/gm, '<h2>$1</h2>')
                // Bold
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                // Italic
                .replace(/\*([^*]+)\*/g, '<em>$1</em>')
                // Images
                .replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1" class="md-image">')
                // Links
                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
                // Unordered lists
                .replace(/^\- (.*$)/gm, '<li>$1</li>')
                // Horizontal rules
                .replace(/^---$/gm, '<hr class="divider">')
                // Paragraphs (lines with content not already tagged)
                .replace(/^(?!<[hlupic]|<\/|$)(.*$)/gm, '<p>$1</p>')
                // Clean up empty paragraphs
                .replace(/<p><\/p>/g, '')
                // Wrap consecutive <li> in <ul>
                .replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');

            return html;
        }

        // Load and render projects
        (function () {
            const container = document.getElementById('projects-container');

            fetch('projects/manifest.json')
                .then(res => res.json())
                .then(projects => {
                    if (projects.length === 0) {
                        container.innerHTML = '<p class="empty-state">NO PROJECTS FOUND</p>';
                        return;
                    }

                    // Sort by date, newest first
                    projects.sort((a, b) => new Date(b.date) - new Date(a.date));

                    let html = '';
                    projects.forEach((project, index) => {
                        const statusClass = project.status.toLowerCase();
                        const tags = project.tags ? project.tags.join(' / ') : '';

                        html += `
                        <article class="project-block" id="project-${index}">
                            <div class="project-meta-bar">
                                <span class="project-id">${project.id}</span>
                                <span class="project-status status-${statusClass}">${project.status}</span>
                            </div>
                            <h2 class="project-title">${project.title}</h2>
                            <div class="project-info">
                                <span>${project.date}</span>
                                <span>${tags}</span>
                                ${project.repo ? `<a href="${project.repo}" target="_blank">[REPO]</a>` : ''}
                            </div>
                            <div class="project-content" id="content-${index}">
                                <span class="mono">&gt; loading README.md...</span>
                            </div>
                        </article>
                        ${index < projects.length - 1 ? '<hr class="divider">' : ''}
                    `;
                    });

                    container.innerHTML = html;

                    // Load each project's README
                    projects.forEach((project, index) => {
                        const basePath = 'projects/' + project.folder + '/';
                        fetch(basePath + 'README.md')
                            .then(res => res.text())
                            .then(content => {
                                // Fix image paths to be relative to project folder
                                content = content.replace(/\(assets\//g, '(' + basePath + 'assets/');
                                const contentEl = document.getElementById('content-' + index);
                                contentEl.innerHTML = parseMarkdown(content);
                            })
                            .catch(() => {
                                document.getElementById('content-' + index).innerHTML =
                                    '<p class="error-state">ERROR: README.md NOT FOUND</p>';
                            });
                    });
                })
                .catch(err => {
                    container.innerHTML = `<p class="error-state">ERROR: ${err.message}</p>`;
                });
        })();
    </script>

    <script>
        (function () {
            let t = 0;
            document.addEventListener('mousemove', function (e) {
                if (Date.now() - t < 50) return;
                t = Date.now();
                const p = document.createElement('div');
                p.className = 'cursor-trail';
                p.style.left = e.clientX + 'px';
                p.style.top = e.clientY + 'px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 800);
            });
        })();
    </script>
</body>

</html>